{
  "id": "smart-home-advanced",
  "name": "Advanced Smart Home Control System",
  "description": "A comprehensive smart home automation system that combines weather data, time-based triggers, and conditional events to control multiple smart home devices",
  "type": "sequence",
  "frequency": "daily",
  "scheduled_time": "07:00:00",
  "timezone": "America/New_York",
  "status": "active",
  "error_policy": "continue",
  "timeout": 3600,
  "max_executions": null,
  "user_id": "system",
  
  "steps": [
    {
      "id": "get-weather-forecast",
      "name": "Get Today's Weather Forecast",
      "position": 1,
      "description": "Retrieve today's weather forecast including temperature, precipitation, and weather conditions",
      "execution_mode": "direct",
      "tool_name": "weather_tool",
      "operation": "get_forecast",
      "parameters": {
        "location": "New York, NY",
        "days": 1,
        "details": true
      },
      "output_key": "weather_data",
      "condition_type": "always",
      "max_retries": 3,
      "retry_delay": 60
    },
    {
      "id": "get-wbgt-index",
      "name": "Calculate Heat Stress Index",
      "position": 2,
      "description": "Calculate the Wet Bulb Globe Temperature for heat stress assessment",
      "execution_mode": "direct",
      "tool_name": "weather_tool",
      "operation": "calculate_wbgt",
      "parameters": {
        "location": "New York, NY",
        "use_forecast": true
      },
      "output_key": "heat_stress_data",
      "condition_type": "always",
      "max_retries": 2,
      "retry_delay": 30
    },
    {
      "id": "set-ac-heat-wave",
      "name": "Set AC for Heat Wave",
      "position": 3,
      "description": "Set air conditioning to a lower temperature during extreme heat",
      "execution_mode": "direct",
      "tool_name": "kasa_tool",
      "operation": "set_thermostat",
      "parameters": {
        "device_name": "Living Room Thermostat",
        "temperature": 68,
        "mode": "cool"
      },
      "output_key": "ac_heat_wave_result",
      "condition_type": "if_data",
      "condition_data_key": "heat_stress_data.risk_level",
      "condition_operator": "eq",
      "condition_value": "very_high",
      "max_retries": 2,
      "retry_delay": 30
    },
    {
      "id": "set-ac-hot-day",
      "name": "Set AC for Hot Day",
      "position": 4,
      "description": "Set air conditioning to a comfortable temperature on hot days",
      "execution_mode": "direct",
      "tool_name": "kasa_tool",
      "operation": "set_thermostat",
      "parameters": {
        "device_name": "Living Room Thermostat",
        "temperature": 72,
        "mode": "cool"
      },
      "output_key": "ac_hot_day_result",
      "condition_type": "if_data",
      "condition_data_key": "weather_data.result.max_temp",
      "condition_operator": "gt",
      "condition_value": 85,
      "max_retries": 2,
      "retry_delay": 30
    },
    {
      "id": "set-heat-cold-day",
      "name": "Set Heat for Cold Day",
      "position": 5,
      "description": "Turn on heating system when cold weather is expected",
      "execution_mode": "direct",
      "tool_name": "kasa_tool",
      "operation": "set_thermostat",
      "parameters": {
        "device_name": "Living Room Thermostat",
        "temperature": 70,
        "mode": "heat"
      },
      "output_key": "heat_cold_day_result",
      "condition_type": "if_data",
      "condition_data_key": "weather_data.result.min_temp",
      "condition_operator": "lt",
      "condition_value": 45,
      "max_retries": 2,
      "retry_delay": 30
    },
    {
      "id": "set-ac-normal",
      "name": "Set Normal Temperature",
      "position": 6,
      "description": "Set thermostat to normal eco-friendly temperature for mild days",
      "execution_mode": "direct",
      "tool_name": "kasa_tool",
      "operation": "set_thermostat",
      "parameters": {
        "device_name": "Living Room Thermostat",
        "temperature": 74,
        "mode": "auto"
      },
      "output_key": "normal_temp_result",
      "condition_type": "if_no_data",
      "condition_data_key": "ac_hot_day_result",
      "condition_operator": "exists",
      "on_failure_step_id": "send-error-notification",
      "max_retries": 2,
      "retry_delay": 30
    },
    {
      "id": "check-rain-forecast",
      "name": "Check Rain Probability",
      "position": 7,
      "description": "Check if rain is expected today",
      "execution_mode": "direct",
      "tool_name": "weather_tool",
      "operation": "get_precipitation",
      "parameters": {
        "location": "New York, NY",
        "detailed": true
      },
      "output_key": "rain_data",
      "condition_type": "always",
      "max_retries": 2,
      "retry_delay": 30
    },
    {
      "id": "turn-off-sprinklers",
      "name": "Turn Off Sprinklers if Rain Expected",
      "position": 8,
      "description": "Turn off garden sprinklers if significant rain is expected",
      "execution_mode": "direct",
      "tool_name": "kasa_tool",
      "operation": "power_control",
      "parameters": {
        "device_id": "Garden Sprinkler Switch",
        "state": "off"
      },
      "output_key": "sprinkler_result",
      "condition_type": "if_data",
      "condition_data_key": "rain_data.probability",
      "condition_operator": "gt",
      "condition_value": 50,
      "max_retries": 2,
      "retry_delay": 30
    },
    {
      "id": "set-living-room-lights-sunny",
      "name": "Set Living Room Lights for Sunny Day",
      "position": 9,
      "description": "Adjust living room lights to cool white on sunny days",
      "execution_mode": "direct",
      "tool_name": "kasa_tool",
      "operation": "set_color_temp",
      "parameters": {
        "device_id": "Living Room Main Light",
        "temperature": 5000
      },
      "output_key": "lights_sunny_result",
      "condition_type": "if_data",
      "condition_data_key": "weather_data.result.weather_condition",
      "condition_operator": "contains",
      "condition_value": "Clear",
      "max_retries": 2,
      "retry_delay": 30
    },
    {
      "id": "set-living-room-lights-cloudy",
      "name": "Set Living Room Lights for Cloudy Day",
      "position": 10,
      "description": "Adjust living room lights to warm white on cloudy days",
      "execution_mode": "direct",
      "tool_name": "kasa_tool",
      "operation": "set_color_temp",
      "parameters": {
        "device_id": "Living Room Main Light",
        "temperature": 3000
      },
      "output_key": "lights_cloudy_result",
      "condition_type": "if_data",
      "condition_data_key": "weather_data.result.weather_condition",
      "condition_operator": "contains",
      "condition_value": "Cloudy",
      "max_retries": 2,
      "retry_delay": 30
    },
    {
      "id": "set-evening-mood-lighting",
      "name": "Schedule Evening Mood Lighting",
      "position": 11,
      "description": "Set up a schedule for evening mood lighting",
      "execution_mode": "direct",
      "tool_name": "kasa_tool",
      "operation": "set_color",
      "parameters": {
        "device_id": "Living Room Accent Light",
        "hue": 240,
        "saturation": 70,
        "value": 60
      },
      "output_key": "evening_light_result",
      "condition_type": "always",
      "max_retries": 2,
      "retry_delay": 30
    },
    {
      "id": "set-bedroom-lights-schedule",
      "name": "Schedule Bedroom Lights",
      "position": 12,
      "description": "Set up a schedule for bedroom dimming in the evening",
      "execution_mode": "direct",
      "tool_name": "kasa_tool",
      "operation": "set_brightness",
      "parameters": {
        "device_id": "Bedroom Light",
        "brightness": 30
      },
      "output_key": "bedroom_light_result",
      "condition_type": "always",
      "max_retries": 2,
      "retry_delay": 30
    },
    {
      "id": "energy-monitoring-report",
      "name": "Get Energy Usage Report",
      "position": 13,
      "description": "Generate a daily energy usage report from smart devices",
      "execution_mode": "direct",
      "tool_name": "kasa_tool",
      "operation": "get_energy_usage",
      "parameters": {
        "device_id": "Living Room Smart Plug",
        "period": "today"
      },
      "output_key": "energy_report",
      "condition_type": "always",
      "max_retries": 2,
      "retry_delay": 30
    },
    {
      "id": "send-automation-report",
      "name": "Send Smart Home Daily Report",
      "position": 14,
      "description": "Send a daily report of smart home status and energy usage",
      "execution_mode": "direct",
      "tool_name": "email_tool",
      "operation": "send_email",
      "parameters": {
        "to": "homeowner@example.com",
        "subject": "Smart Home Daily Status Report",
        "body": "Today's Smart Home Report:\n\nWeather: The forecast shows a high of {weather_data.result.max_temp}°F and a low of {weather_data.result.min_temp}°F.\n\nHeat Stress Level: {heat_stress_data.risk_level}\n\nRain Probability: {rain_data.probability}%\n\nEnergy Usage: {energy_report.energy_data.consumption_today} kWh\n\nAll systems are operating normally. Your smart home settings have been optimized for today's conditions."
      },
      "output_key": "report_email_result",
      "condition_type": "always",
      "max_retries": 2,
      "retry_delay": 30
    },
    {
      "id": "send-error-notification",
      "name": "Send Error Notification",
      "position": 15,
      "description": "Send an error notification if any part of the automation fails",
      "execution_mode": "direct",
      "tool_name": "email_tool",
      "operation": "send_email",
      "parameters": {
        "to": "homeowner@example.com",
        "subject": "Smart Home Automation Error",
        "body": "There was an error with your smart home automation system. Please check the system settings and device connections."
      },
      "output_key": "error_notification_result",
      "condition_type": "if_failure",
      "max_retries": 1,
      "retry_delay": 60
    }
  ]
}
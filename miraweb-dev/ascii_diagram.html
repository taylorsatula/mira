<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MIRA Conversation Flow - ASCII Style</title>
    <style>
        :root {
            --primary: #4f46e5;
            --primary-light: #818cf8;
            --secondary: #10b981;
            --secondary-light: #34d399;
            --accent: #8b5cf6;
            --accent-light: #a78bfa;
            --box-border: #d1d5db;
            --bg-light: #f9fafb;
            --text-dark: #1f2937;
            --text-medium: #4b5563;
            --box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
        
        body {
            font-family: 'Fira Code', 'Source Code Pro', monospace;
            line-height: 1.5;
            color: var(--text-dark);
            background-color: var(--bg-light);
            padding: 20px;
            overflow-x: auto;
        }
        
        h1 {
            text-align: center;
            margin: 20px 0 40px;
        }
        
        .diagram-container {
            white-space: pre;
            font-family: 'Fira Code', 'Source Code Pro', monospace;
            overflow-x: auto;
            padding: 20px;
            line-height: 1.2;
            background-color: white;
            box-shadow: var(--box-shadow);
            border-radius: 8px;
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .ascii-box {
            color: var(--primary);
            font-weight: bold;
        }
        
        .title-text {
            color: var(--text-dark);
            font-weight: bold;
        }
        
        .function-text {
            color: var(--secondary);
            font-style: italic;
        }
        
        .arrow-text {
            color: var(--accent);
            font-weight: bold;
        }
        
        .note-text {
            color: var(--text-medium);
            font-style: italic;
        }
        
        .process-text {
            color: var(--primary);
        }
        
        .highlight {
            color: var(--secondary);
            font-weight: bold;
        }
        
        /* Make the diagram visible on load */
        #flow-diagram {
            opacity: 1;
            transition: opacity 1s ease;
        }
        
        /* For printing */
        @media print {
            body {
                padding: 0;
                font-size: 9pt;
            }
            
            .diagram-container {
                box-shadow: none;
                page-break-inside: avoid;
            }
        }
    </style>
</head>
<body>
    <h1>MIRA: She's not an idiot!</h1>
<pre id="flow-diagram">
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                <span class="title-text">USER INPUTS MESSAGE</span>                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           <span class="function-text">conversation.add_message("user", message)</span>     â”‚
â”‚           <span class="note-text">(message added to conversation history)</span>       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚                                    â”‚
          â–¼                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  <span class="title-text">WORKFLOW DETECTION</span>  â”‚             â”‚  <span class="title-text">TOOL RELEVANCE ANALYSIS</span>â”‚
â”‚                     â”‚             â”‚                          â”‚
â”‚ <span class="function-text">workflow_manager.</span>    â”‚             â”‚ <span class="function-text">tool_relevance_engine.</span>  â”‚ 
â”‚ <span class="function-text">detect_workflow()</span>    â”‚             â”‚ <span class="function-text">manage_tool_relevance()</span>  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                                       â”‚
          â”‚ <span class="note-text">[If workflow detected]</span>                â”‚ <span class="note-text">[If no active workflow]</span>
          â”‚ <span class="note-text">Example: "calendar_booking"</span>           â”‚
          â”‚                                       â”‚
          â–¼                                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ <span class="process-text">Store workflow ID &</span> â”‚             â”‚ <span class="process-text">Calculate relevance</span>     â”‚
â”‚ <span class="process-text">update working</span>      â”‚             â”‚ <span class="process-text">scores by comparing</span>     â”‚
â”‚ <span class="process-text">memory with hint</span>    â”‚             â”‚ <span class="process-text">message embedding</span>       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚ <span class="process-text">to tool examples</span>        â”‚
          â”‚                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                                       â”‚
          â”‚                                       â–¼
          â”‚                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚                         â”‚ <span class="process-text">Enable relevant tools</span>   â”‚
          â”‚                         â”‚ <span class="process-text">and disable tools</span>       â”‚
          â”‚                         â”‚ <span class="process-text">no longer needed</span>        â”‚
          â”‚                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                                       â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              <span class="title-text">PREPARE FOR LLM REQUEST</span>                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚                       â”‚
                â–¼                       â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚     <span class="title-text">WORKING MEMORY</span>        â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚       <span class="title-text">UPDATES</span>             â”‚            
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            
            â”‚                
            â”‚ 
            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                <span class="title-text">ACTIVE WORKFLOW EXAMPLE</span>                    â”‚
â”‚              <span class="note-text">(calendar_booking workflow)</span>                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â”‚
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚                                             â”‚
   â–¼                                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ <span class="title-text">WORKFLOW HEADER</span>        â”‚              â”‚ <span class="title-text">WORKFLOW STEPS</span>         â”‚
â”‚                        â”‚              â”‚                        â”‚
â”‚ â€¢ Workflow name        â”‚              â”‚ <span class="note-text">ONLY CURRENTLY</span>         â”‚
â”‚ â€¢ Description          â”‚              â”‚ <span class="note-text">AVAILABLE STEPS:</span>       â”‚
â”‚                        â”‚              â”‚                        â”‚
â”‚ <span class="note-text">Example:</span>               â”‚              â”‚ <span class="note-text">Example:</span>               â”‚
â”‚ <span class="highlight">"Calendar Booking</span>      â”‚              â”‚ <span class="highlight">1. Get event details</span>   â”‚
â”‚ <span class="highlight">workflow to schedule</span>   â”‚              â”‚    <span class="highlight">(ID: step1)</span>         â”‚
â”‚ <span class="highlight">appointments"</span>          â”‚              â”‚                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚    - Specific guidance â”‚
             â”‚                          â”‚      for current step  â”‚
             â”‚                          â”‚                        â”‚
             â”‚                          â”‚    - Required inputs:  â”‚
             â”‚                          â”‚      * Event title     â”‚
             â”‚                          â”‚      * Date and time   â”‚
             â”‚                          â”‚      * Duration        â”‚
             â”‚                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚                                       â”‚
             â”‚                                       â”‚
             â–¼                                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ <span class="title-text">WORKFLOW CHECKLIST</span>     â”‚              â”‚ <span class="title-text">WORKFLOW DATA</span>          â”‚
â”‚                        â”‚              â”‚                        â”‚
â”‚ â€¢ Step 1: [<span class="highlight">ğŸ”„</span>] Get     â”‚              â”‚ Data collected so far: â”‚
â”‚   event details        â”‚              â”‚                        â”‚
â”‚   (ID: step1)          â”‚              â”‚ <span class="note-text">(Initially empty, gets</span> â”‚
â”‚                        â”‚              â”‚  <span class="note-text">updated as steps are</span>  â”‚
â”‚ â€¢ Step 2: [ ] Find     â”‚              â”‚  <span class="note-text">completed)</span>            â”‚
â”‚   available slots      â”‚              â”‚                        â”‚
â”‚   (ID: step2)          â”‚              â”‚ <span class="note-text">Example after step1:</span>   â”‚
â”‚                        â”‚              â”‚ â€¢ <span class="highlight">event_title: "Team</span>   â”‚
â”‚ â€¢ Step 3: [ ] Send     â”‚              â”‚   <span class="highlight">Meeting"</span>             â”‚
â”‚   invitations          â”‚              â”‚ â€¢ <span class="highlight">event_date: "2023-</span>   â”‚
â”‚   (ID: step3)          â”‚              â”‚   <span class="highlight">10-15T14:00:00"</span>      â”‚
â”‚                        â”‚              â”‚ â€¢ <span class="highlight">duration: 60</span>         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚                                       â”‚
             â”‚                                       â”‚
             â–¼                                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ <span class="title-text">WORKFLOW NAVIGATION</span>    â”‚              â”‚ <span class="title-text">TOOL ENABLEMENT</span>        â”‚
â”‚                        â”‚              â”‚                        â”‚
â”‚ Commands to navigate   â”‚              â”‚ Only enable tools      â”‚
â”‚ the workflow:          â”‚              â”‚ needed for current     â”‚
â”‚                        â”‚              â”‚ step:                  â”‚
â”‚ â€¢ <span class="function-text">&lt;workflow_complete_</span>  â”‚              â”‚                        â”‚
â”‚   <span class="function-text">step id="step1" /&gt;</span>   â”‚              â”‚ <span class="note-text">Example for step1:</span>     â”‚
â”‚                        â”‚              â”‚ â€¢ <span class="highlight">calendar_tool</span>        â”‚
â”‚ â€¢ <span class="function-text">&lt;workflow_skip_step</span>  â”‚              â”‚ â€¢ <span class="highlight">user_profile_tool</span>    â”‚
â”‚   <span class="function-text">id="step1" /&gt;</span>        â”‚              â”‚                        â”‚
â”‚                        â”‚              â”‚ <span class="note-text">(Other tools disabled)</span> â”‚
â”‚ â€¢ <span class="function-text">&lt;workflow_complete /&gt;</span>â”‚              â”‚                        â”‚
â”‚                        â”‚              â”‚                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚                                       â”‚
             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         <span class="function-text">working_memory.get_prompt_content()</span>               â”‚
â”‚         <span class="note-text">compiles all memory items into one string</span>         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  <span class="title-text">PARALLEL MESSAGE PREPARATION</span>                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                                          â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                             â”‚
â”‚<span class="process-text">Format message history</span>     â”‚                             â”‚
â”‚<span class="function-text">conversation.get_formatted_</span>â”‚                             â”‚
â”‚<span class="function-text">messages()</span>                 â”‚                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                             â”‚
            â”‚                                             â”‚
            â”‚                                             â”‚
            â–¼                                             â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                             â”‚
â”‚<span class="process-text">Get available tools</span>        â”‚                             â”‚
â”‚<span class="function-text">tool_repo.get_all_tool_</span>    â”‚                             â”‚
â”‚<span class="function-text">definitions()</span>              â”‚                             â”‚
â”‚                           â”‚                             â”‚
â”‚<span class="note-text">Example with workflow:</span>     â”‚                             â”‚
â”‚â€¢ <span class="highlight">calendar_tool</span>            â”‚                             â”‚
â”‚â€¢ <span class="highlight">user_profile_tool</span>        â”‚                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                             â”‚
            â”‚                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              <span class="title-text">FINAL LLM REQUEST ASSEMBLY</span>                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ <span class="process-text">Assemble final LLM API request with:</span>                    â”‚
â”‚ <span class="process-text">1. Formatted message history</span>                            â”‚
â”‚ <span class="process-text">2. SYSTEM PROMPT = static system prompt +</span>               â”‚
â”‚ <span class="process-text">                   dynamic content from working memory</span>  â”‚
â”‚ <span class="process-text">3. Enabled tool definitions</span>                             â”‚
â”‚ <span class="process-text">4. API parameters (temp, max_tokens, etc.)</span>              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ <span class="function-text">Send API request to Claude API</span>                          â”‚
â”‚ <span class="function-text">llm_bridge.generate_response()</span>                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ <span class="title-text">Process LLM Response</span>                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â–¼                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚<span class="process-text">Extract text content</span>   â”‚     â”‚<span class="process-text">Extract tool calls</span>     â”‚
â”‚<span class="process-text">from response</span>          â”‚     â”‚<span class="process-text">from response</span>          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                             â”‚
          â–¼                             â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚<span class="process-text">Parse tags from</span>        â”‚               â”‚
â”‚<span class="process-text">response</span>               â”‚               â”‚
â”‚<span class="note-text">(topic_changed, etc.)</span>  â”‚               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
          â”‚                             â”‚
          â–¼                             â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚<span class="process-text">Update topic_changed</span>   â”‚               â”‚
â”‚<span class="process-text">flag in tool relevance</span> â”‚               â”‚
â”‚<span class="process-text">engine for next round</span>  â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
          â”‚                             â–¼
          â”‚               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚               â”‚ <span class="note-text">[If tool calls present]</span>   â”‚
          â”‚               â”‚ <span class="process-text">Process each tool call</span>    â”‚
          â”‚               â”‚ <span class="function-text">with tool_repo.invoke_tool</span>â”‚
          â”‚               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                         â”‚
          â”‚                         â–¼
          â”‚               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚               â”‚<span class="process-text">Add tool results to</span>        â”‚
          â”‚               â”‚<span class="process-text">conversation as user msg</span>   â”‚
          â”‚               â”‚<span class="process-text">Continue API calls until</span>   â”‚
          â”‚               â”‚<span class="process-text">no more tool calls</span>         â”‚
          â”‚               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                         â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ <span class="process-text">Check for workflow commands in response</span>                 â”‚
â”‚ <span class="function-text">workflow_manager.check_for_workflow_commands()</span>          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â”‚
             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
             â”‚                              â”‚
             â–¼                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ <span class="note-text">[If workflow command</span>      â”‚   â”‚ <span class="note-text">[If no workflow command]</span>  â”‚
â”‚  <span class="note-text">detected]</span>                â”‚   â”‚                           â”‚
â”‚                           â”‚   â”‚ <span class="process-text">Continue normal</span>           â”‚
â”‚ <span class="note-text">Example:</span>                  â”‚   â”‚ <span class="process-text">conversation flow</span>         â”‚
â”‚ <span class="function-text">&lt;workflow_complete_step</span>   â”‚   â”‚                           â”‚
â”‚  <span class="function-text">id="step1" /&gt;</span>            â”‚   â”‚                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ <span class="title-text">Update workflow state:</span>    â”‚
â”‚                           â”‚
â”‚ <span class="process-text">1. Mark step as completed</span> â”‚
â”‚ <span class="process-text">2. Store collected data</span>   â”‚
â”‚ <span class="process-text">3. Recalculate available</span>  â”‚
â”‚ <span class="process-text">   steps</span>                  â”‚
â”‚ <span class="process-text">4. Update tool access</span>     â”‚
â”‚                           â”‚
â”‚ <span class="note-text">Example after completing</span>  â”‚
â”‚ <span class="note-text">step1:</span>                    â”‚
â”‚ â€¢ <span class="highlight">step1 â†’ completed</span>       â”‚
â”‚ â€¢ <span class="highlight">step2 â†’ available</span>       â”‚
â”‚ â€¢ <span class="highlight">New tools enabled for</span>   â”‚
â”‚ <span class="highlight">  step2</span>                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ <span class="title-text">Update working memory with new workflow state</span> â”‚
â”‚                                               â”‚
â”‚ <span class="note-text">Example for step2:</span>                            â”‚
â”‚ â€¢ <span class="process-text">Remove step1 guidance</span>                       â”‚
â”‚ â€¢ <span class="process-text">Add step2 guidance</span>                          â”‚
â”‚ â€¢ <span class="process-text">Update checklist:</span>                           â”‚
â”‚   - <span class="highlight">Step 1: [âœ…] Get event details</span>            â”‚
â”‚   - <span class="highlight">Step 2: [ğŸ”„] Find available slots</span>         â”‚
â”‚ â€¢ <span class="process-text">Show collected data from step1</span>              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ <span class="function-text">Add final response to conversation</span>                       â”‚
â”‚ <span class="function-text">conversation.add_message("assistant", assistant_response)</span>â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ <span class="title-text">Return response to user</span>                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</pre>
</body>
</html>